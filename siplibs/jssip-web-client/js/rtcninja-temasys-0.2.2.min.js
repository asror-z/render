/*
 * rtcninja-temasys.js v0.2.2
 * rtcninja.js module for the Temasys WebRTC plugin.
 * Copyright 2015 Temasys Communications Pte Ltd
 * Copyright 2015-2015 IÃ±aki Baz Castillo <inaki.baz@eface2face.com> (http://eface2face.com)
 * License Apache-2.0
 *
 * The original source has been modified in order to change the exposed API.
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.rtcninjaTemasys=e()}}(function(){var e;return function n(e,t,o){function r(a,s){if(!t[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=t[a]={exports:{}};e[a][0].call(c.exports,function(n){var t=e[a][1][n];return r(t?t:n)},c,c.exports,n,e,t,o)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,n){(function(t){function o(e,n,t){e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent&&e.attachEvent("on"+n,t)}function r(){if(u("injectPlugin()"),S=P.INJECTING,l.msie&&10>=y){var e=document.createDocumentFragment();for(C=document.createElement("div"),C.innerHTML='<object id="'+T.pluginId+'" type="'+T.type+'" width="1" height="1"><param name="pluginId" value="'+T.pluginId+'" /><param name="windowless" value="false" /><param name="pageId" value="'+N+'" /><param name="onload" value="'+T.onload+'" />'+(x.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+"</object>";C.firstChild;)e.appendChild(C.firstChild);document.body.appendChild(e),C=document.getElementById(T.pluginId)}else C=document.createElement("object"),C.id=T.pluginId,C.width="1px",C.height="1px",C.type=T.type,C.innerHTML='<param name="onload" value="'+T.onload+'"><param name="pluginId" value="'+T.pluginId+'"><param name="windowless" value="false" /> '+(x.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+'<param name="pageId" value="'+N+'">',document.body.appendChild(C);S=P.INJECTED}function i(){for(;S!==P.READY;);}function a(){u("defineWebRTCInterface()"),S=P.INITIALIZING,f=function(e,n,t){i(),C.getUserMedia(e,n,t)},m=function(e,n){for(var t=e.iceServers,o=0,r=t.length;r>o;o++)t[o].hasCredentials=t[o].hasOwnProperty("username")&&t[o].hasOwnProperty("credential");var a=n&&n.mandatory?n.mandatory:null,s=n&&n.optional?n.optional:null;return i(),C.PeerConnection(N,t,a,s)},p=function(e){return i(),C.ConstructSessionDescription(e.type,e.sdp)},g=function(e){return i(),C.ConstructIceCandidate(e.sdpMid||"",e.sdpMLineIndex,e.candidate)},v=function(){},v.getSources=function(e){i(),C.GetSources(e)},h=function(e,n){if(n.enableSoundTracks(!0),"audio"!==e.nodeName.toLowerCase()){var t=0===e.id.length?Math.random().toString(36).slice(2):e.id;if(e.isWebRTCPlugin&&e.isWebRTCPlugin()){for(var r=e.children,i=0,a=r.length;i!==a;i++)if("streamId"===r[i].name){r[i].value=n.id;break}e.setStreamId(n.id)}else{var s=document.createDocumentFragment(),d=document.createElement("div"),c=e.className?'class="'+e.className+'" ':"",u=e.getBoundingClientRect();for(d.innerHTML='<object id="'+t+'" '+c+'type="'+T.type+'"><param name="pluginId" value="'+t+'" /> <param name="pageId" value="'+N+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+n.id+'" /> </object>';d.firstChild;)s.appendChild(d.firstChild);e.parentNode.insertBefore(s,e),s=document.getElementById(t),s.width=u.width+"px",s.height=u.height+"px",e.parentNode.removeChild(e)}var f=document.getElementById(t);return f.onplaying=e.onplaying?e.onplaying:function(){},l.msie&&(o(f,"playing",f.onplaying),f.onclick=e.onclick?e.onclick:function(){},f._TemOnClick=function(e){f.onclick({srcElement:document.getElementById(e)})}),f}return e},b=!1,d(function(){r()})}function s(e,n,t,o){return s.isRequired()?(c(x,e),void(s.isInstalled()?(u("plugin already installed"),a(),E.getUserMedia=f,E.RTCPeerConnection=m,E.RTCSessionDescription=p,E.RTCIceCandidate=g,E.MediaStreamTrack=v,E.attachMediaStream=h,E.canRenegotiate=b,n&&n()):(u("plugin required but not installed"),E={},t&&t({isIE:l.msie,isSafari:l.safari,downloadLink:T.downloadLink})))):void(o&&o())}n.exports=s;var l=e("bowser").browser,d=e("domready"),c=e("merge"),u=e("debug")("rtcninja:TemasysPlugin"),f=null,m=null,p=null,g=null,v=null,h=null,b=!1,y=Number(l.version)||0,w=!(l.mobile&&l.tablet),I=!!navigator.platform.match(/^Win/i),k=!!navigator.platform.match(/^Mac/i),C=null,x={getAllCams:!1},E={},T={prefix:"Tem",plugName:"TemWebRTCPlugin",pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__onTemasysPluginReady",portalLink:"http://temasys.atlassian.net/wiki/display/TWPP/WebRTC+Plugins",downloadLink:null,companyName:"Temasys"};k?T.downloadLink="http://bit.ly/1n77hco":I&&(T.downloadLink="http://bit.ly/1kkS4FN");var N=Math.random().toString(36).slice(2),P={NONE:0,INITIALIZING:1,INJECTING:2,INJECTED:3,READY:4},S=P.NONE;t.__onTemasysPluginReady=function(){u("__onTemasysPluginReady()"),d(function(){S=P.READY})},s.isRequired=function(){return w&&l.msie&&I?!0:w&&l.safari&&k?!0:!1},s.isInstalled=function(){if(l.safari){for(var e=navigator.plugins,n=0,o=e.length;o>n;n++)if(e[n].name.indexOf(T.plugName)>=0)return!0;return!1}if(l.msie)try{{new t.ActiveXObject(T.prefix+"."+T.plugName)}return!0}catch(r){return!1}},s.monitorPluginInstallation=function(e,n,t,o){if(l.safari)return u("monitorPluginInstallation() | Safari requires restart, cannot monitor plugin installation"),!1;t=Number(t),o=Number(o),t||(t=3e3),o||(o=18e4),u("monitorPluginInstallation() | [interval: %dms | maxtime: %dms]",t,o);var r=null,i=setInterval(function(){s.isInstalled()&&(u("monitorPluginInstallation() | plugin installed"),clearInterval(i),clearTimeout(r),s(),e&&e())},t);return r=setTimeout(function(){u("monitorPluginInstallation() | monitoring ended"),clearInterval(i),n&&n()},o),!0},Object.defineProperty(s,"interface",{get:function(){return E}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bowser:2,debug:3,domready:6,merge:7}],2:[function(n,t){!function(n,o){"undefined"!=typeof t&&t.exports?t.exports.browser=o():"function"==typeof e&&e.amd?e(o):this[n]=o()}("bowser",function(){function e(e){function t(n){var t=e.match(n);return t&&t.length>1&&t[1]||""}var o,r=t(/(ipod|iphone|ipad)/i).toLowerCase(),i=/like android/i.test(e),a=!i&&/android/i.test(e),s=t(/version\/(\d+(\.\d+)?)/i),l=/tablet/i.test(e),d=!l&&/[^-]mobi/i.test(e);/opera|opr/i.test(e)?o={name:"Opera",opera:n,version:s||t(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(e)?o={name:"Windows Phone",windowsphone:n,msie:n,version:t(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(e)?o={name:"Internet Explorer",msie:n,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(e)?o={name:"Chrome",chrome:n,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:r?(o={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},s&&(o.version=s)):/sailfish/i.test(e)?o={name:"Sailfish",sailfish:n,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?o={name:"SeaMonkey",seamonkey:n,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(e)?(o={name:"Firefox",firefox:n,version:t(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(o.firefoxos=n)):/silk/i.test(e)?o={name:"Amazon Silk",silk:n,version:t(/silk\/(\d+(\.\d+)?)/i)}:a?o={name:"Android",version:s}:/phantom/i.test(e)?o={name:"PhantomJS",phantom:n,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?o={name:"BlackBerry",blackberry:n,version:s||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(e)?(o={name:"WebOS",webos:n,version:s||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(o.touchpad=n)):o=/bada/i.test(e)?{name:"Bada",bada:n,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(e)?{name:"Tizen",tizen:n,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||s}:/safari/i.test(e)?{name:"Safari",safari:n,version:s}:{},/(apple)?webkit/i.test(e)?(o.name=o.name||"Webkit",o.webkit=n,!o.version&&s&&(o.version=s)):!o.opera&&/gecko\//i.test(e)&&(o.name=o.name||"Gecko",o.gecko=n,o.version=o.version||t(/gecko\/(\d+(\.\d+)?)/i)),a||o.silk?o.android=n:r&&(o[r]=n,o.ios=n);var c="";r?(c=t(/os (\d+([_\s]\d+)*) like mac os x/i),c=c.replace(/[_\s]/g,".")):a?c=t(/android[ \/-](\d+(\.\d+)*)/i):o.windowsphone?c=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):o.webos?c=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?c=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?c=t(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(c=t(/tizen[\/\s](\d+(\.\d+)*)/i)),c&&(o.osversion=c);var u=c.split(".")[0];return l||"ipad"==r||a&&(3==u||4==u&&!d)||o.silk?o.tablet=n:(d||"iphone"==r||"ipod"==r||a||o.blackberry||o.webos||o.bada)&&(o.mobile=n),o.msie&&o.version>=10||o.chrome&&o.version>=20||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1?o.a=n:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6?o.c=n:o.x=n,o}var n=!0,t=e("undefined"!=typeof navigator?navigator.userAgent:"");return t._detect=e,t})},{}],3:[function(e,n,t){function o(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function r(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return e;var o="color: "+this.color;e=[e[0],o,"color: inherit"].concat(Array.prototype.slice.call(e,1));var r=0,i=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))}),e.splice(i,0,o),e}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?l.removeItem("debug"):l.debug=e}catch(n){}}function s(){var e;try{e=l.debug}catch(n){}return e}t=n.exports=e("./debug"),t.log=i,t.formatArgs=r,t.save=a,t.load=s,t.useColors=o;var l;l="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:window.localStorage,t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){return JSON.stringify(e)},t.enable(s())},{"./debug":4}],4:[function(e,n,t){function o(){return t.colors[c++%t.colors.length]}function r(e){function n(){}function r(){var e=r,n=+new Date,i=n-(d||n);e.diff=i,e.prev=d,e.curr=n,d=n,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=o());var a=Array.prototype.slice.call(arguments);a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var s=0;a[0]=a[0].replace(/%([a-z%])/g,function(n,o){if("%%"===n)return n;s++;var r=t.formatters[o];if("function"==typeof r){var i=a[s];n=r.call(e,i),a.splice(s,1),s--}return n}),"function"==typeof t.formatArgs&&(a=t.formatArgs.apply(e,a));var l=r.log||t.log||console.log.bind(console);l.apply(e,a)}n.enabled=!1,r.enabled=!0;var i=t.enabled(e)?r:n;return i.namespace=e,i}function i(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),o=n.length,r=0;o>r;r++)n[r]&&(e=n[r].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))}function a(){t.enable("")}function s(e){var n,o;for(n=0,o=t.skips.length;o>n;n++)if(t.skips[n].test(e))return!1;for(n=0,o=t.names.length;o>n;n++)if(t.names[n].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}t=n.exports=r,t.coerce=l,t.disable=a,t.enable=i,t.enabled=s,t.humanize=e("ms"),t.names=[],t.skips=[],t.formatters={};var d,c=0},{ms:5}],5:[function(e,n){function t(e){var n=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(n){var t=parseFloat(n[1]),o=(n[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"y":return t*c;case"days":case"day":case"d":return t*d;case"hours":case"hour":case"h":return t*l;case"minutes":case"minute":case"m":return t*s;case"seconds":case"second":case"s":return t*a;case"ms":return t}}}function o(e){return e>=d?Math.round(e/d)+"d":e>=l?Math.round(e/l)+"h":e>=s?Math.round(e/s)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function r(e){return i(e,d,"day")||i(e,l,"hour")||i(e,s,"minute")||i(e,a,"second")||e+" ms"}function i(e,n,t){return n>e?void 0:1.5*n>e?Math.floor(e/n)+" "+t:Math.ceil(e/n)+" "+t+"s"}var a=1e3,s=60*a,l=60*s,d=24*l,c=365.25*d;n.exports=function(e,n){return n=n||{},"string"==typeof e?t(e):n.long?r(e):o(e)}},{}],6:[function(n,t){!function(n,o){"undefined"!=typeof t?t.exports=o():"function"==typeof e&&"object"==typeof e.amd?e(o):this[n]=o()}("domready",function(){var e,n=[],t=document,o=t.documentElement.doScroll,r="DOMContentLoaded",i=(o?/^loaded|^c/:/^loaded|^i|^c/).test(t.readyState);return i||t.addEventListener(r,e=function(){for(t.removeEventListener(r,e),i=1;e=n.shift();)e()}),function(e){i?e():n.push(e)}})},{}],7:[function(e,n){!function(e){function t(e,n){if("object"!==r(e))return n;for(var o in n)e[o]="object"===r(e[o])&&"object"===r(n[o])?t(e[o],n[o]):n[o];return e}function o(e,n,o){var a=o[0],s=o.length;(e||"object"!==r(a))&&(a={});for(var l=0;s>l;++l){var d=o[l],c=r(d);if("object"===c)for(var u in d){var f=e?i.clone(d[u]):d[u];a[u]=n?t(a[u],f):f}}return a}function r(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var i=function(e){return o(e===!0,!1,arguments)},a="merge";i.recursive=function(e){return o(e===!0,!0,arguments)},i.clone=function(e){var n,t,o=e,a=r(e);if("array"===a)for(o=[],t=e.length,n=0;t>n;++n)o[n]=i.clone(e[n]);else if("object"===a){o={};for(n in e)o[n]=i.clone(e[n])}return o},e?n.exports=i:window[a]=i}("object"==typeof n&&n&&"object"==typeof n.exports&&n.exports)},{}]},{},[1])(1)});
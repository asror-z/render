<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Language" content="en-us" />
    <meta http-equiv="imagetoolbar" content="false" />
    <meta name="MSSmartTagsPreventParsing" content="true" />
    <meta name="description" content="Add SIP signaling to your WebRTC app with this simple, open source JavaScript library - SIP.js." />
    <meta name="viewport" content="initial-scale=1" />
    <title>SIP.js</title>
   <link href="css/reset.css" rel="stylesheet" type="text/css" />
    <link href="css/960.css" rel="stylesheet" type="text/css" />
    <link href="css/uv_active4d.css" rel="stylesheet" type="text/css" />
    <link href="css/documentation.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="css/adaptive.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="css/pygments.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="css/success-popup.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="homepage/jquery.js" type="text/javascript"></script>
    <script src="homepage/documentation.js" type="text/javascript"></script>
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon-7.ico"/>
</head>


    <body class="overview">
        <div id="dev"></div>

            <div >
                <div class="wrapper-bg-extend">
                    <div class="full-width-divider group home-feature" id="feature-selector">
                        <div>
                <ul class="highlights">
                    <li id="feature-video-audio">
                        <img class="icon-unselected" src="img/video-audio.png" alt="video + audio">
                        <img class="icon-selected" src="img/video-audio-highlight.png" alt="video + audio highlight">
                        <h4>video + audio</h4>
                    </li>
                    <li id="feature-message">
                        <img class="icon-unselected" src="img/message.png" alt="message">
                        <img class="icon-selected" src="img/message-highlight.png" alt="message highlight">
                        <h4>message</h4>
                    </li>
                </ul>
                <!-- This draws an arrow that we use to indicate the highlighted feature -->
                <svg class="arrow mobile-hide" id="feature-arrow" width="60" height="34" viewbox="0 0 80 45">
                    <polygon points="40,5 75,40 5,40"></polygon>
                </svg>
            </div>
        </div>

        <div class="full-width-divider mid-gray-bg feature" id="feature-demo">
            <div id="demo-error">
                <h1>Oops!</h1>
                <h2>Looks like your browser can't run this demo.</h2>
                <p>
                    To get the full experience, download the latest version of
                    <em>Chrome</em> or <em>Firefox</em>
                </p>
            </div>
            <div id="content-video-audio">
                <div class="two-column-boxes">
                    <div class="column-box">
                        <div class="demo-window">
                            <div class="demo-view">
                                <video id="video-of-bob" muted="muted"></video>
                            </div>
                            <div class="left">
                                <h4>Alice's View</h4>
                                <h5>Demo user one</h5>
                            </div>
                            <button id="alice-video-button" class="right" type="button">video</button>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="column-box">
                        <div class="demo-window">
                            <div class="demo-view">
                                <video id="video-of-alice" muted="muted"></video>
                            </div>
                            <div class="left">
                                <h4>Bob's View</h4>
                                <h5>Demo user two</h5>
                            </div>
                            <button id="bob-video-button" class="right" type="button">video</button>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
            <div id="content-message">
               <div class="two-column-boxes">
                    <div class="column-box">
                        <div class="demo-window">
                            <div class="demo-view">
                                <div id="alice-message-display" class="message-display">
                                    <p class="message"><span class="message-from">Bob:</span> <span class="message-body placeholder">No messages yet</span></p>
                                </div>
                                <textarea id="alice-message-input" class="message-input" placeholder="Enter your message to Bob here!"></textarea>
                            </div>
                            <div class="left">
                                <h4>Alice's View</h4>
                                <h5>Demo user one</h5>
                            </div>
                            <button id="alice-message-button" class="right" type="button">send message</button>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="column-box">
                        <div class="demo-window">
                            <div class="demo-view">
                                <div id="bob-message-display" class="message-display">
                                    <p class="message"><span class="message-from">Alice:</span> <span class="message-body placeholder">No messages yet</span></p>
                                </div>
                                <textarea id="bob-message-input" class="message-input" placeholder="Enter your message to Alice here!"></textarea>
                            </div>
                            <div class="left">
                                <h4>Bob's View</h4>
                                <h5>Demo user two</h5>
                            </div>
                            <button id="bob-message-button" class="right" type="button">send message</button>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>

    </div>

</div>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1008379-16', 'sipjs.com');
    ga('send', 'pageview');
</script>
<script>
    // Remove all 'no-js-hide' classes because Javascript is working
    $(function () {
        $('.no-js-hide').each(function (i, e) {
            $(e).removeClass('no-js-hide');
        });
        $('.no-js-block').each(function (i, e) {
            $(e).removeClass('no-js-block');
        });
    });
</script>


<script src="homepage2/https_redirect.js" type="text/javascript"></script>
<script src="homepage2/mobile_nav.js" type="text/javascript"></script>
<!--<script src="https://cdn.statically.io/gh/onsip/sipjs.com/0b012363/static/download/sip-0.15.11.js" type="text/javascript"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jssip/3.1.2/jssip.min.js"> </script>
<script src="homepage2/feature_selector.js" type="text/javascript"></script>
<!--<script src="homepage2/sipjs_domain.js" type="text/javascript"></script>-->
<script>
    // sipjs_demos.js
    //
    // Even though both "Alice" and "Bob" are running on the same computer,
    // this demo behaves as if the dialog was an SIP call over a network.

    var URL = window.URL || window.webkitURL;

    function getCookie(key) {
        var re = new RegExp('(?:(?:^|.*;\s*) ?' + key + '\s*\=\s*([^;]*).*$)|^.*$');
        return document.cookie.replace(re, "$1");

    }

    // This demo uses unauthenticated users on the "sipjs.onsip.com" demo domain.
    // To allow multiple users to run the demo without playing a game of
    // chatroulette, we give both callers in the demo a random token and then only
    // make calls between users with these token suffixes.
    // So, you still might run into a user besides yourself.
    function randomString(length, chars) {
        var result = '';
        for (var i = length; i > 0; --i)
            result += chars[Math.round(Math.random() * (chars.length - 1))];
        return result;
    }
    // Each session gets a token that expires 1 day later. This is so we minimize
    // the number of users we register for the SIP domain, because SIP hosts
    // generally have limits on the number of registered users you may have in total
    // or over a period of time.
    var token = getCookie('onsipToken');
    if (token === '') {
        token = randomString(32, ['0123456789',
            'abcdefghijklmnopqrstuvwxyz',
            'ABCDEFGHIJKLMNOPQRSTUVWXYZ'].join(''));
        var d = new Date();
        d.setTime(d.getTime() + 1000*60*60*24); // expires in 1 day
        document.cookie = ('onsipToken=' + token + ';'
            + 'expires=' + d.toUTCString() + ';');
    }
    var domain = 'sipjs.onsip.com';
    var aliceURI      = 'alice.' + window.token + '@' + domain;
    var aliceName     = 'Alice';

    var bobURI        = 'bob.' + window.token + '@' + domain;
    var bobName       = 'Bob';

    // Function: createSimple
    //   creates a SIP.js Simple instance with the given arguments plugged into the
    //   configuration. This is a standard Simple instance for WebRTC calls.
    //
    // Arguments:
    //   callerURI: the URI of the caller, aka, the URI that belongs to this user.
    //   displayName: what name we should display the user as
    //   remoteVideo: the DOM element id of the video for the remote
    //   buttonId: the DOM element id of the button for that user
    function createSimple(callerURI, displayName, target, remoteVideo, buttonId) {
        var remoteVideoElement = document.getElementById(remoteVideo);
        var button = document.getElementById(buttonId);

        var configuration = {
            media: {
                remote: {
                    video: remoteVideoElement,
                    // Need audio to be not null to do audio & video instead of just video
                    audio: remoteVideoElement
                }
            },
            ua: {
                traceSip: true,
                uri: callerURI,
                displayName: displayName,
                userAgentString: SIP.C.USER_AGENT + " sipjs.com"
            }
        };
        var simple = new SIP.Web.Simple(configuration);

        // Adjust the style of the demo based on what is happening
        simple.on('ended', function() {
            remoteVideoElement.style.visibility = 'hidden';
            button.firstChild.nodeValue = 'video';
        });

        simple.on('connected', function() {
            remoteVideoElement.style.visibility = 'visible';
            button.firstChild.nodeValue = 'hang up';
        });

        simple.on('ringing', function() {
            simple.answer();
        });

        button.addEventListener('click', function() {
            // No current call up
            if (simple.state === SIP.Web.Simple.C.STATUS_NULL ||
                simple.state === SIP.Web.Simple.C.STATUS_COMPLETED) {
                simple.call(target);
            } else {
                simple.hangup();
            }
        });

        return simple;
    }

    // Function: setUpMessageInterface
    //   Sets up the chat interface for text messaging
    //
    // Arguments:
    //   userAgent: the local user agent that sends and receives messages
    //   target: the target URI that our local user agent communicates with
    //   messageRenderId: the ID of where we display sent and received chat messages
    //   messageInputId: the ID for the text area that the local user agent types
    //                   his or her messages into
    //   buttonId: the ID of the button that actually sends the given input message
    function setUpMessageInterface(simple, target,
                                   messageRenderId, messageInputId, buttonId) {
        var messageRender = document.getElementById(messageRenderId);
        var messageInput = document.getElementById(messageInputId);
        var button = document.getElementById(buttonId);

        function sendMessage() {
            var msg = messageInput.value;
            // Only send a message if the message is non-empty
            if (msg !== '') {
                messageInput.value = '';
                simple.message(target, msg);
            }
        }

        // We have placeholder text in the message render box. It should be deleted
        // after we have sent or received our first message. This keeps track of
        // that.
        var noMessages = true;

        // Receive a message and put it in the message display div
        simple.on('message', function (msg) {
            // If we have not received any messages yet, remove the placeholder
            // text.
            if (noMessages) {
                noMessages = false;
                if (messageRender.childElementCount > 0)
                    messageRender.removeChild(messageRender.children[0]);
            }
            var msgTag = createMsgTag(msg.remoteIdentity.displayName, msg.body);
            messageRender.appendChild(msgTag);
        });
        // Cut the content from the input textarea and send it
        button.addEventListener('click', function () {
            sendMessage();
        });
        // Register pressing of the "enter" key while in textarea to send a message.
        // If user presses shift while entering, then add a newline instead.
        messageInput.onkeydown = (function(e) {
            if(e.keyCode == 13 && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    }

    // Function: createMsgTag
    //   creates the HTML tag and its children for a given message.
    //
    // Arguments:
    //   from: the display name of who the message came from
    //   msgBody: the actual body content of the message
    function createMsgTag(from, msgBody) {
        var msgTag = document.createElement('p');
        msgTag.className = 'message';
        // Create the "from" section
        var fromTag = document.createElement('span');
        fromTag.className = 'message-from';
        fromTag.appendChild(document.createTextNode(from + ':'));
        // Create the message body
        var msgBodyTag = document.createElement('span');
        msgBodyTag.className = 'message-body';
        msgBodyTag.appendChild(document.createTextNode(' ' + msgBody));
        // Put everything in the message tag
        msgTag.appendChild(fromTag);
        msgTag.appendChild(msgBodyTag);
        return msgTag;
    }

    (function () {
        if (window.RTCPeerConnection) {
            // Javascript is not disabled and WebRTC works, so hide the
            // "demo-error" div and fix the color of the feature arrow.
            var demoErrorDiv = document.getElementById('demo-error');
            var featureArrow = document.getElementById('feature-arrow');
            function setFeatureArrowColor(color) {
                for (var i=0; i < featureArrow.children.length; i++) {
                    var child = featureArrow.children[i];
                    if (child.tagName === 'polygon') {
                        child.style.fill = color;
                        child.style.stroke = color;
                    }
                }
            }
            demoErrorDiv.style.display = 'none';
            setFeatureArrowColor('rgb(193,191,182)');

            // Now we do SIP.js stuff
            var aliceSimple = createSimple(aliceURI, aliceName, bobURI, 'video-of-bob', 'alice-video-button');
            var bobSimple   = createSimple(bobURI, bobName, aliceURI, 'video-of-alice', 'bob-video-button');

            // We want to only run the demo if all users for the demo can register
            var numToRegister = 2;
            var numRegistered = 0;
            var registrationFailed = false;
            var markAsRegistered = function () {
                numRegistered += 1;
                if (numRegistered >= numToRegister && !registrationFailed) {
                    setupInterfaces();
                }
            };
            var failRegistration = function () {
                registrationFailed = true;
                failInterfaceSetup();
            };
            // We don't want to proceed until we've registered all users.
            // For each registered user, increase the counter.
            aliceSimple.on('registered', markAsRegistered);
            bobSimple.on('registered', markAsRegistered);
            // If any registration fails, then we need to disable the app and tell the
            // user that we could not register them.
            aliceSimple.on('registrationFailed', failRegistration);
            bobSimple.on('registrationFailed', failRegistration);

            // Unregister the user agents and terminate all active sessions when the
            // window closes or when we navigate away from the page
            window.onunload = function () {
                aliceSimple.stop();
                bobSimple.stop();
            };

            // Only run the demo if we could register every user agent
            function setupInterfaces() {
                setUpMessageInterface(aliceSimple, bobURI,
                    'alice-message-display',
                    'alice-message-input',
                    'alice-message-button');
                setUpMessageInterface(bobSimple, aliceURI,
                    'bob-message-display',
                    'bob-message-input',
                    'bob-message-button');
            }
            function failInterfaceSetup() {
                // Display an error message
                demoErrorDiv.style.display = 'block';
                setFeatureArrowColor('rgb(114,117,115)');
                var overlayMessage = demoErrorDiv.getElementsByTagName('p')[0];
                while (overlayMessage.firstChild) {
                    overlayMessage.removeChild(overlayMessage.firstChild);
                }
                overlayMessage.appendChild(document.createTextNode('Max registration limit hit. Could not register all user agents, so they cannot communicate. The app is disabled.'));
            }
        }
    })();

</script>
</body>
</html>
